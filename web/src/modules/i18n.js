import { state, lsGet, lsSet, LS, el } from './state.js';

export const I18N = {
  en: {
    title: "MSP Media Share",
    theme: "Switch Theme",
    settings: "Settings",
    refresh: "Refresh",
    tab_video: "Video",
    tab_audio: "Audio",
    tab_image: "Image",
    tab_other: "Other",
    search_ph: "Search filename (Pinyin/Regex)...",
    sort_name: "Name",
    sort_size: "Size",
    sort_date: "Date",
    sort_order: "Order",
    hint_noshare: "Unconfigured. Click 'Settings' to add shares.",
    preview_none: "No Selection",
    prev: "Prev",
    next: "Next",
    shuffle: "Shuffle",
    loop: "Loop",
    resume: "Resume",
    open_raw: "Open Raw",
    fit_mode: "Fit Mode: Adapt",
    empty_tip: "Select a file to preview",
    playlist: "Playlist",
    not_loaded: "Not Loaded",
    footer_text: "A simple media server for personal use.",
    dlg_title: "Share Settings",
    path_ph: "e.g. D:\\Media",
    label_ph: "Alias (Optional)",
    add: "Add",
    bl_title: "Blacklist Settings",
    bl_exts_ph: "Block Exts (.log; Regex /log$/)",
    bl_files_ph: "Block Files (thumb.db; Regex /^tmp_/)",
    bl_folders_ph: "Block Folders ($RECYCLE.BIN; Regex /^\\./)",
    bl_size_ph: "Block Size (>100MB, 10KB-1MB)",
    bl_hint: `Usage:<br>1. <strong>Regex</strong>: /pattern/<br>2. <strong>Size</strong>: >100MB, 10MB-1GB<br>3. <strong>Units</strong>: B, KB, MB, GB`,
    save_bl: "Save Blacklist",
    dlg_note: "Note: Browser cannot open the system folder picker due to security limits. Please input the path manually.",
    close: "Close",

    // JS Dynamic
    kind_video: "Video",
    kind_audio: "Audio",
    kind_image: "Image",
    kind_other: "Other",
    prev_video: "Prev Video",
    next_video: "Next Video",
    prev_image: "Prev Image",
    next_image: "Next Image",
    prev_audio: "Prev Audio",
    next_audio: "Next Audio",
    prev_item: "Prev Item",
    next_item: "Next Item",

    codec_info: " · Codec: ",
    audio_warn: " · Note: Audio is {0}, browser may not support.",
    err_aborted: "Aborted",
    err_network: "Network Error",
    err_decode: "Decode Failed",
    err_src: "Source Not Supported",
    err_unknown: "Unknown Error",

    meta_urls: "Available: {0}",
    meta_noip: "No LAN IP detected (127.0.0.1 available)",
    hint_stats: "Current: {0}, Total {1}",
    item_count: "{0} · {1} Items",

    // PIN Authentication
    pin_title: "Authentication Required",
    pin_note: "Please enter the PIN code to access this service.",
    pin_placeholder: "Enter PIN",
    pin_submit: "Submit",
    pin_error: "Incorrect PIN. Please try again.",
    pin_checking: "Verifying...",
    
    // New additions
    fit_cover: "Fit Mode: Cover",
    fit_contain: "Fit Mode: Adapt",
    err_audio_format: "Browser may not support this audio format ({0}). Try 'Open Raw'.",
    err_video_format: "Browser may not support this video format ({0}). Try 'Open Raw'.",
    err_unsupported: "Preview not supported for this file type (Try 'Open Raw' to download/view).",
    shares_empty: "No shared folders configured.",
    remove: "Remove",
    msg_bl_saved: "Blacklist saved. Refresh to apply.",
    err_audio_load: "Audio load/decode failed ({0}). Browser may not support codec.",
    err_video_load: "Video load/decode failed ({0}, {1}). Browser may not support codec. {2}Try 'Open Raw' or transcode.",
    err_img_load: "Image load failed ({0}). Try 'Open Raw'.",
    meta_fail: "Connection failed or init failed",
  },
  zh: {
    title: "MSP 媒体分享预览",
    theme: "切换主题",
    settings: "共享目录设置",
    refresh: "刷新",
    tab_video: "视频",
    tab_audio: "音频",
    tab_image: "图片",
    tab_other: "其他",
    search_ph: "搜索文件名 (支持拼音/正则/模糊)…",
    sort_name: "按名称排序",
    sort_size: "按大小排序",
    sort_date: "按时间排序",
    sort_order: "切换正序/倒序",
    hint_noshare: "未配置共享目录。点击右上角“共享目录设置”添加。",
    preview_none: "未选择",
    prev: "上一个",
    next: "下一个",
    shuffle: "随机",
    loop: "循环",
    resume: "继续播放",
    open_raw: "在新标签打开",
    fit_mode: "填充模式：适配",
    empty_tip: "从左侧选择一个媒体文件进行预览",
    playlist: "播放列表",
    not_loaded: "未加载",
    footer_text: "一个适合个人使用的简易媒体服务器。",
    dlg_title: "共享目录设置",
    path_ph: "例如：D:\\Media 或 D:/Media（会自动兼容斜杠）",
    label_ph: "别名（可选）",
    add: "添加",
    bl_title: "文件黑名单设置",
    bl_exts_ph: "屏蔽扩展名 (如 .log, .txt; 支持正则 /log$/)",
    bl_files_ph: "屏蔽文件名 (如 thumb.db; 支持正则 /^tmp_/)",
    bl_folders_ph: "屏蔽文件夹 (如 $RECYCLE.BIN; 支持正则 /^\\./)",
    bl_size_ph: "大小屏蔽 (如: >100MB, 10KB-1MB, 500B)",
    bl_hint: `用法提示：<br>1. <strong>正则匹配</strong>：使用 <code>/</code> 包裹<br>2. <strong>大小范围</strong>：支持 <code>10MB-1GB</code>, <code>&gt;500MB</code><br>3. <strong>单位支持</strong>：B, KB, MB, GB, TB`,
    save_bl: "保存黑名单设置",
    dlg_note: "提示：由于浏览器安全限制，网页无法直接弹出系统文件夹选择器，请手动输入路径。",
    close: "关闭",

    kind_video: "视频",
    kind_audio: "音频",
    kind_image: "图片",
    kind_other: "其他",
    prev_video: "上一个视频",
    next_video: "下一个视频",
    prev_image: "上一张",
    next_image: "下一张",
    prev_audio: "上一首",
    next_audio: "下一首",
    prev_item: "上一个",
    next_item: "下一个",

    codec_info: " · 编码/容器：",
    audio_warn: " · 提示：音频为 {0}，浏览器常不支持",
    err_aborted: "播放被中止",
    err_network: "网络/读取失败",
    err_decode: "解码失败（常见于编码不支持）",
    err_src: "媒体源不支持",
    err_unknown: "未知错误",

    meta_urls: "可用地址：{0}",
    meta_noip: "未检测到局域网 IP（仍可用 127.0.0.1 访问）",
    hint_stats: "当前分类：{0}，共 {1} 个",
    item_count: "{0} · {1} 项",

    // New additions
    fit_cover: "填充模式：铺满",
    fit_contain: "填充模式：适配",
    err_audio_format: "该音频格式浏览器可能不支持（{0}）。请用“在新标签打开”。",
    err_video_format: "该视频格式浏览器可能不支持（{0}）。请用“在新标签打开”。",
    err_unsupported: "该文件类型暂不支持预览（可用“在新标签打开”下载/查看）。",
    shares_empty: "当前没有共享目录。",
    remove: "移除",
    msg_bl_saved: "黑名单已保存，刷新媒体库后生效。",
    err_audio_load: "音频加载/解码失败（{0}）。可能是浏览器不支持该编码，建议用“在新标签打开”下载后本地播放器播放。",
    err_video_load: "视频加载/解码失败（{0}，{1}）。同为 mp4/mkv 也可能因编码不同而无法播放。{2}建议用“在新标签打开”，或转码为 H.264/AAC（或仅转音频为 AAC）再播放。",
    err_img_load: "图片加载失败（{0}）。可用“在新标签打开”查看原文件。",
    meta_fail: "服务连接失败或初始化失败",

    // PIN Authentication
    pin_title: "身份验证",
    pin_note: "请输入 PIN 码以访问此服务。",
    pin_placeholder: "输入 PIN 码",
    pin_submit: "提交",
    pin_error: "PIN 码错误，请重试。",
    pin_checking: "验证中...",
  }
};

export function t(key, ...args) {
  const dict = I18N[state.lang] || I18N.en;
  let val = dict[key] || I18N.en[key] || key;
  for (let i = 0; i < args.length; i++) {
    val = val.replace(`{${i}}`, args[i]);
  }
  return val;
}

export function initLang() {
  const saved = lsGet(LS.lang);
  const lang = saved === "zh" ? "zh" : "en"; // Default en
  state.lang = lang;
  document.documentElement.lang = lang === "zh" ? "zh-CN" : "en";
  return lang;
}
