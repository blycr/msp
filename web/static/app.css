:root {
  /* Light Theme (GitHub-inspired) */
  --md-primary: #0969da;       /* GitHub blue */
  --md-primary-2: #1f6feb;     /* Hover blue */
  --md-surface: #ffffff;       /* Card/Panel */
  --md-bg: #f6f8fa;            /* Page background */
  --md-text: #24292f;          /* Primary text */
  --md-sub: #57606a;           /* Muted text */
  --md-border: #d0d7de;        /* Border */
  --md-danger: #cf222e;        /* Danger */
  --md-hover: rgba(36, 41, 47, 0.06); /* Subtle hover */
  --md-active: rgba(36, 41, 47, 0.12);/* Subtle active */
  --elev-1: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.08);
  --radius: 12px;
  --transition: all 0.3s ease-in-out;
  --plyr-color-main: var(--md-primary);
}

[data-theme="dark"] {
  /* Dark Theme (GitHub-inspired) */
  --md-primary: #58a6ff;       /* Accent blue */
  --md-primary-2: #1f6feb;     /* Hover blue */
  --md-surface: #161b22;       /* Card/Panel */
  --md-bg: #0d1117;            /* Page background */
  --md-text: #c9d1d9;          /* Primary text */
  --md-sub: #8b949e;           /* Muted text */
  --md-border: #30363d;        /* Border */
  --md-danger: #ff7b72;        /* Danger */
  --md-hover: rgba(240, 246, 252, 0.05); /* Subtle hover */
  --md-active: rgba(240, 246, 252, 0.10);/* Subtle active */
  --elev-1: 0 4px 6px -1px rgba(2, 6, 12, 0.6), 0 2px 4px -1px rgba(2, 6, 12, 0.4);
  --plyr-color-main: var(--md-primary);
}

* {
  box-sizing: border-box;
}

button, input, select, textarea {
  color: var(--md-text) !important;
  background-color: transparent;
  font-family: inherit;
}

/* Fix specific button backgrounds if needed */
.btn {
  background: var(--md-primary) !important;
  color: #fff !important;
}
.btn:hover {
  background: var(--md-primary-2) !important;
}
.btn--ghost {
  background: transparent !important;
  color: var(--md-primary) !important;
  border: 1px solid var(--md-border) !important;
}
.btn--ghost:hover {
  background: var(--md-hover) !important;
}
[data-theme="dark"] .btn--ghost {
  color: var(--md-text) !important;
}
.theme-btn {
  color: var(--md-text) !important;
}
.tab {
  color: var(--md-text) !important;
}
.tab--active {
  color: var(--md-text) !important;
  background: var(--md-active) !important;
}

html, body {
  height: 100%;
}

body {
  margin: 0;
  background: var(--md-bg);
  color: var(--md-text);
  font-family: "Microsoft YaHei", "微软雅黑", Roboto, system-ui, -apple-system, Segoe UI, Arial, sans-serif;
  transition: background-color 0.6s cubic-bezier(0.4, 0, 0.2, 1), color 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Common transitions for theme changes */
.panel, .tab, .textfield, .item, .btn--ghost, .audioCover, .lyrics, .dialog, .share, .topbar, .plitem {
  transition: background-color 0.6s cubic-bezier(0.4, 0, 0.2, 1), 
              border-color 0.6s cubic-bezier(0.4, 0, 0.2, 1), 
              color 0.6s cubic-bezier(0.4, 0, 0.2, 1), 
              box-shadow 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  will-change: background-color, border-color, color, box-shadow;
}

/* Optimize video player transitions */
#videoEl, .plyr {
  /* Only animate specific properties, avoid 'all' */
  transition: opacity 0.3s ease;
  will-change: opacity;
}

.topbar{
  position:sticky;
  top:0;
  z-index:10;
  display:flex;
  gap:12px;
  align-items:center;
  padding:12px 14px;
  background:var(--md-surface);
  border-bottom:1px solid var(--md-border);
}

.topbar__title{
  font-weight:700;
  letter-spacing:.2px;
}

.topbar__meta{
  flex:1;
  color:var(--md-sub);
  font-size:13px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.layout{
  display:grid;
  grid-template-columns:minmax(280px, 22vw) minmax(0, 1fr) minmax(280px, 22vw);
  gap:clamp(16px, 2vw, 24px);
  padding:clamp(16px, 2vw, 24px);
  align-items:start;
}

.panel{
  background:var(--md-surface);
  border:1px solid var(--md-border);
  border-radius:16px;
  box-shadow:var(--elev-1);
  overflow:hidden;
  min-height:0;
  max-width:100%;
}

.sidebar{
  display:flex;
  flex-direction:column;
}

.stage{
  display:flex;
  flex-direction:column;
  min-width:320px;
}

.playlist{
  display:flex;
  flex-direction:column;
  min-width:280px;
}

.tabs{
  display:flex;
  gap:8px;
  padding:12px 14px;
  border-bottom:1px solid var(--md-border);
}

.tab{
  flex:1;
  border:1px solid var(--md-border);
  background:var(--md-surface);
  padding:12px 10px;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
  color:var(--md-text);
  font-size: 15px;
}

.tab--active{
  border-color:var(--md-border);
  background:var(--md-active);
  color:var(--md-text);
}

.search{
  padding:12px 14px;
  border-bottom:1px solid var(--md-border);
}

.textfield{
  width:100%;
  padding:12px 16px;
  border:1px solid var(--md-border);
  background:var(--md-surface);
  color:var(--md-text);
  border-radius:12px;
  outline:none;
  font-size:15px;
}

.textfield:focus{
  border-color:var(--md-primary);
  box-shadow:0 0 0 3px rgba(25,118,210,.15);
}

.list__body{
  padding:12px;
  overflow:auto;
  flex:1;
}

.item{
  display:flex;
  gap:12px;
  padding:12px 16px;
  border:1px solid var(--md-border);
  border-radius:14px;
  cursor:pointer;
  margin-bottom:10px;
}

.item:hover{
  border-color:var(--md-border);
  background:var(--md-hover);
}

.item__main{flex:1; min-width:0}
.item__name{
  font-weight:700;
  font-size: 15px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  margin-bottom: 4px;
}
.item__sub{
  font-size:13px;
  color:var(--md-sub);
  margin-top:2px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.theme-btn {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 20px;
  padding: 8px;
  border-radius: 50%;
  transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
}

.theme-btn:hover {
  background-color: var(--md-hover);
  transform: rotate(15deg);
}

.badge{
  font-size:12px;
  padding:4px 8px;
  border-radius:999px;
  border:1px solid var(--md-border);
  color:var(--md-sub);
  white-space:nowrap;
  height:fit-content;
}

.hint{
  padding:10px;
  color:var(--md-sub);
  font-size:13px;
  border-top:1px solid var(--md-border);
}

.now{
  padding:12px 14px;
  border-bottom:1px solid var(--md-border);
  display:flex;
  flex-direction:column;
  gap:8px;
}

.now__title{
  font-weight:900;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.now__sub{
  color:var(--md-sub);
  font-size:12px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.now__actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}

.playerbox{
  border:1px dashed var(--md-border);
  border-radius:14px;
  padding:12px;
  background:var(--md-surface);
  min-height:340px;
  display:flex;
  flex-direction:column;
  gap:12px;
  align-items:stretch;
  justify-content:flex-start;
}

#videoEl,#audioEl,#imgEl{width:100%}
#videoEl{max-height:72vh; background:#000}
#audioEl{max-width:820px}
#imgEl{max-height:72vh; object-fit:contain}

.plyr{width:100%}
.plyr{--plyr-color-main:var(--md-primary)}
.plyr__video-wrapper{width:100%}
.plyr input[type="range"]{touch-action:pan-x}
.plyr__controls{color:var(--md-text) !important}
.plyr__control{color:var(--md-text) !important}
.plyr__control:hover{background:var(--md-hover) !important; color:var(--md-text) !important}
.plyr__controls svg{fill:currentColor !important}
.plyr__time{color:var(--md-text) !important}
.plyr__progress__buffer{color:var(--md-sub) !important; background:rgba(255,255,255,0.1)}
.plyr__tooltip{
  background:var(--md-surface);
  color:var(--md-text);
  border:1px solid var(--md-border);
}
.plyr__progress input[type="range"],
.plyr__volume input[type="range"]{
  color:var(--md-primary);
}
.plyr__menu__container{
  background:var(--md-surface);
  color:var(--md-text);
  border:1px solid var(--md-border);
  box-shadow:var(--elev-1);
}
.plyr__menu__container .plyr__control{
  color:var(--md-text);
}
.plyr__menu__value{
  color:var(--md-sub);
}
.plyr:fullscreen,
.plyr--fullscreen-fallback{
  width:100vw !important; 
  height:100vh !important; 
  max-width:none !important;
  max-height:none !important;
  background:#000 !important; 
  position:fixed !important; 
  top:0 !important; 
  left:0 !important; 
  right:0 !important; 
  bottom:0 !important;
  z-index:2147483647 !important;
  border-radius:0 !important;
  margin:0 !important;
  padding:0 !important;
  transform:none !important;
  box-shadow: none !important;
}
.plyr:fullscreen .plyr__video-wrapper,
.plyr--fullscreen-fallback .plyr__video-wrapper{
  height:100% !important; 
  width:100% !important; 
  max-width:none !important;
  max-height:none !important;
  background:#000 !important; 
  padding-bottom:0 !important; 
  margin:0 !important;
  transform:none !important;
  position:absolute !important;
  top:0 !important;
  left:0 !important;
}
.plyr:fullscreen video,
.plyr--fullscreen-fallback video{
  width:100% !important; 
  height:100% !important; 
  max-width:none !important; 
  max-height:none !important; 
  object-fit:cover !important; 
  margin:0 !important;
  padding:0 !important;
  border:none !important;
}

#videoEl:fullscreen{max-height:none; width:100%; height:100%; object-fit:cover}
#videoEl:-webkit-full-screen{max-height:none; width:100%; height:100%; object-fit:cover}
.plyr:fullscreen #videoEl,
.plyr--fullscreen-fallback #videoEl{
  max-height:none !important;
  width:100%;
  height:100%;
  object-fit:cover;
}

.plyr:fullscreen video[data-fit="contain"],
.plyr--fullscreen-fallback video[data-fit="contain"]{
  object-fit:contain !important;
}
.plyr:fullscreen #videoEl[data-fit="contain"],
.plyr--fullscreen-fallback #videoEl[data-fit="contain"]{
  object-fit:contain !important;
}

.audioMeta{
  width:100%;
  max-width:820px;
  display:none;
  gap:12px;
  align-items:flex-start;
}

.audioCover{
  width:160px;
  height:160px;
  object-fit:cover;
  border-radius:12px;
  border:1px solid var(--md-border);
  background:var(--md-bg);
  flex:0 0 auto;
}

.lyrics{
  flex:1;
  min-width:0;
  max-height:320px;
  overflow:auto;
  padding:8px 10px;
  border:1px solid var(--md-border);
  border-radius:12px;
  background:var(--md-surface);
  font-size:14px;
  line-height:1.65;
  white-space:pre-wrap;
  position:relative; /* Fix scrolling offset */
  scrollbar-width: none !important; /* Firefox */
}

.lyrics::-webkit-scrollbar {
  display: none !important; /* Chrome/Safari/Edge */
}

.ly{
  padding:4px 2px;
  color:var(--md-sub);
}

.ly--active{
  color:var(--md-text);
  font-weight:800;
}

@media (max-width: 640px){
  .audioMeta{flex-direction:column}
  .audioCover{width:100%; height:auto; aspect-ratio:1/1}
  .lyrics{max-height:260px}
  #videoEl{max-height:52vh}
}

.empty{
  color:var(--md-sub);
  font-size:14px;
}

.playlist__title{
  padding:12px 14px;
  border-bottom:1px solid var(--md-border);
  font-weight:900;
}

.playlist__meta{
  padding:10px 14px;
  color:var(--md-sub);
  font-size:12px;
  border-bottom:1px solid var(--md-border);
}

.playlist__body{
  padding:10px;
  overflow:auto;
  flex:1;
}

.plitem{
  display:flex;
  gap:10px;
  align-items:center;
  padding:10px;
  border-radius:12px;
  cursor:pointer;
}

.plitem:hover{
  background:var(--md-hover);
}

.plitem--active{
  background:var(--md-active);
}

.plitem__idx{
  width:22px;
  color:var(--md-sub);
  font-size:12px;
  text-align:right;
  flex:0 0 auto;
}

.plitem__main{
  flex:1;
  min-width:0;
}

.plitem__name{
  font-weight:700;
  font-size:13px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.plitem__sub{
  font-size:11px;
  color:var(--md-sub);
  margin-top:2px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.toggle{
  display:inline-flex;
  gap:8px;
  align-items:center;
  font-size:13px;
  color:var(--md-text);
  user-select:none;
}
.toggle input{transform:translateY(1px)}

.btn{
  border:none;
  background:var(--md-primary);
  color:#fff;
  font-weight:700;
  padding:10px 12px;
  border-radius:10px;
  cursor:pointer;
}

.btn:hover{background:var(--md-primary-2)}
.btn:disabled{opacity:.5; cursor:not-allowed}

.btn--ghost{
  background:transparent;
  color:var(--md-primary);
  border:1px solid var(--md-border);
}
.btn--ghost:hover{
  background:var(--md-hover);
}

[data-theme="dark"] .btn--ghost{
  color:var(--md-text);
}

/* Dialog overrides */
[hidden] { display: none !important; }

.dialog__backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.38);
  z-index:50;
}

.dialog{
  position:fixed;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:min(720px, calc(100vw - 24px));
  max-height: 85vh;
  display: flex;
  flex-direction: column;
  background:var(--md-surface);
  border:1px solid var(--md-border);
  border-radius:16px;
  box-shadow:0 18px 50px rgba(0,0,0,.22);
  z-index:60;
  overflow:hidden;
}

.dialog__title{
  padding:14px 16px;
  font-weight:900;
  border-bottom:1px solid var(--md-border);
  flex: 0 0 auto;
}
.dialog__body{
  padding:14px 16px;
  display:flex;
  flex-direction:column;
  gap:10px;
  overflow-y: auto;
  flex: 1;
  min-height: 0;
}
.dialog__actions{
  padding:12px 16px;
  border-top:1px solid var(--md-border);
  display:flex;
  justify-content:flex-end;
  flex: 0 0 auto;
}

.row{
  display:flex;
  gap:10px;
  align-items:center;
}

.sharelist{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-top:4px;
}

.share{
  display:flex;
  gap:10px;
  align-items:center;
  padding:10px;
  border:1px solid var(--md-border);
  border-radius:12px;
}
.share__main{flex:1; min-width:0}
.share__path{
  color:var(--md-sub);
  font-size:12px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.small{
  font-size:12px;
  color:var(--md-sub);
}

::view-transition-old(root),
::view-transition-new(root){
  animation: theme-fade .6s cubic-bezier(0.4,0,0.2,1);
}
@keyframes theme-fade{
  from{opacity:.92}
  to{opacity:1}
}
.theme-swap .panel,
.theme-swap .tab,
.theme-swap .textfield,
.theme-swap .item,
.theme-swap .btn,
.theme-swap .btn--ghost,
.theme-swap .plyr,
.theme-swap .plyr__controls,
.theme-swap .plyr__control,
.theme-swap .plyr__menu__container,
.theme-swap .plyr__tooltip,
.theme-swap .topbar,
.theme-swap .plitem,
.theme-swap .audioCover,
.theme-swap .lyrics,
.theme-swap .dialog,
.theme-swap .share{
  transition:none !important;
}

.footer {
  text-align: center;
  padding: 20px;
  font-size: 0.85em;
  color: var(--md-sub);
  margin-top: 20px;
  border-top: 1px solid var(--md-border);
}
.footer a {
  color: inherit;
  text-decoration: none;
  font-weight: bold;
}
.footer a:hover {
  text-decoration: underline;
}

@media (max-width: 1240px){
  .layout{
    grid-template-columns:minmax(240px, 360px) minmax(0, 1fr);
    grid-template-rows:auto auto;
  }
  .sidebar{grid-column:1; grid-row:1 / span 2}
  .stage{grid-column:2; grid-row:1}
  .playlist{grid-column:2; grid-row:2}
}

@media (max-width: 980px){
  .layout{
    grid-template-columns:1fr;
    grid-template-rows:auto auto auto;
  }
  .sidebar{grid-column:1; grid-row:1}
  .stage{grid-column:1; grid-row:2}
  .playlist{grid-column:1; grid-row:3}
  .playerbox{min-height:280px}
}

@media (min-width: 981px){
  .sidebar,.playlist{min-height:calc(100vh - 76px)}
}