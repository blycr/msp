# 迁移指南 (Migration Guide)

本文档说明了 MSP 从 v1 (Vanilla JS) 版本升级到 v2 (Vue 3) 版本的变更详情及迁移注意事项。

## 🔄 架构变更概览

| 特性 | v1 (旧版) | v2 (新版) | 说明 |
| :--- | :--- | :--- | :--- |
| **前端框架** | Vanilla JS (原生) | **Vue 3** | 组件化开发，更好的状态管理 |
| **开发语言** | JavaScript | **TypeScript** | 强类型，减少运行时错误 |
| **构建工具** | 无 (直接引入) | **Vite** | 模块化构建，热更新，资源压缩 |
| **包管理器** | npm | **pnpm** | 更快、更节省磁盘空间的依赖管理 |
| **状态管理** | 全局对象 (`window.state`) | **Pinia** | 响应式状态库，开发者体验更佳 |

## 📦 数据兼容性

本次重构主要集中在 **前端 UI 层** 和 **工程化**，后端数据层保持完全兼容。

1.  **配置文件 (`config.json`)**: 
    - **完全兼容**。您无需修改现有的配置文件。
    - v2 版本可能会引入新的 UI 设置项，它们会自动追加到配置中。
2.  **数据库 (`msp.db`)**: 
    - **完全兼容**。SQLite 表结构未发生破坏性变更。
    - 升级后直接启动 v2 版本即可读取原有媒体库索引。

## 🛠️ 对于开发者

如果您维护了自己的分支或有二次开发代码，请注意以下变更：

### 1. 前端目录重构
*   旧版 `web/` 目录已被归档/替换。
*   新版前端代码位于 `web/`，是一个标准的 Vite 项目结构。
*   **操作变更**:
    *   ❌ 不再直接修改 `index.html` 中的 JS 逻辑。
    *   ✅ 在 `web/src/components` 中修改 Vue 组件。
    *   ✅ 修改后必须运行 `pnpm build` 生成 `dist`，Go 才能加载新界面。

### 2. 依赖管理
*   前端必须使用 **pnpm**。
*   请确保安装了 Node.js 18+。
*   运行 `corepack enable` 以激活 pnpm。

### 3. API 调用
*   旧版 `api.js` (XHR) 已被 `web/src/services/api.ts` (Axios) 替代。
*   所有 API 请求现在都有 TypeScript 类型定义 (`web/src/types/index.ts`)。

## ❓ 常见问题

**Q: 我升级后界面显示空白？**
A: 请尝试强制刷新浏览器缓存 (Ctrl+F5)，因为 v2 使用了全新的资源路径。

**Q: 以前的自定义 CSS 还能用吗？**
A: v2 的 DOM 结构和类名已完全改变，旧的 CSS Hack 可能失效。建议通过修改 `web/src/style.css` 变量来进行主题定制。
