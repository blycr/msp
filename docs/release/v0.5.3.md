# MSP v0.5.3 Release Notes / 发布说明

## 核心更新

- 首屏更快（分段加载）
  - `GET /api/media` 支持 `limit` 参数：例如 `GET /api/media?limit=200`
  - 返回值包含各分类总数（`videosTotal/audiosTotal/imagesTotal/othersTotal`）以及 `limited=true`，便于前端先快出列表再补全
- 缓存更可靠（ETag + stale-while-revalidate）
  - `GET /api/media` 支持 `ETag/If-None-Match`，命中返回 `304 Not Modified`
  - 服务端媒体列表缓存采用 stale-while-revalidate：缓存过期时先返回旧数据，同时后台异步刷新
  - 运行时会落盘缓存到 `config.json.media_cache.json`，以便下次启动快速加载（该文件为本地运行产物，不应提交到远程）
- 探测更丰富（/api/probe）
  - `GET /api/probe?id=...` 返回容器、音视频编码信息
  - 同时返回该视频的外挂字幕列表（sidecar subtitles），便于前端按需挂载字幕轨
- PWA 与 API 缓存策略
  - Service Worker 对 `/api/*` 使用 NetworkOnly，避免 API 被离线缓存导致“数据不刷新/首屏空”等问题
- 体验修复
  - 全屏（F11）下播放列表分页会随容器高度自适应，避免列表区域“占不满”

## English Summary

- Faster first paint:
  - `GET /api/media?limit=200` for a quick initial list, then load full list in background
  - Response includes totals per category and `limited=true`
- More reliable caching:
  - `ETag/If-None-Match` with `304 Not Modified`
  - Stale-while-revalidate in-memory cache on the server
  - Runtime disk cache: `config.json.media_cache.json` (local artifact, do not commit)
- Richer probing:
  - `GET /api/probe?id=...` returns container/codec info + sidecar subtitles list
- PWA:
  - Service Worker uses NetworkOnly for `/api/*` to avoid stale API cache
- UX fix:
  - Playlist pagination auto-fits in fullscreen layouts

