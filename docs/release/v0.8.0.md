# v0.8.0

## 核心变更 (Core Changes)

- **智能转码引擎 (Smart Transcoding Engine)**:
  - 新增 **服务端按需转码** 功能，无需预处理即可播放不兼容格式（如 MKV, AVI, FLAC 等）。
  - **智能 Seek**: 即使是实时转码流，现在也支持拖动进度条。后端实现了基于 FFmpeg 的精确切片与时间戳对齐 (`-copyts`)。
  - **自动检测**: 自动检测客户端浏览器支持的格式，仅对不支持的格式启用转码。

- **播放进度同步重构 (Progress Sync Refactor)**:
  - 彻底移除了基于 `UserPrefs` (Key-Value) 的低效进度保存机制。
  - 新增专用数据库表 `playback_progresses`，大幅降低数据库 I/O 压力并解决日志刷屏问题。
  - 前端 API 升级，支持更可靠的断点续播。

## 新增功能 (Features)

- **转码支持**:
  - 视频: 自动转码非 MP4/WebM 格式（如 H.265/HEVC, MKV 容器）。
  - 音频: 自动转码非 MP3/AAC 格式（如 FLAC, APE, OGG）。
  - 需要系统安装 `ffmpeg` 并在 PATH 中可用。

- **API 更新**:
  - `GET /api/progress?id=...`: 获取单文件进度。
  - `POST /api/progress`: 汇报播放进度。
  - `GET /api/stream`: 新增 `start` 参数支持服务端 Seek。

## 修复 (Fixes)

- 修复了转码流在浏览器中无法拖动进度条的问题（通过后端 `-ss` 切片实现）。
- 修复了播放大量文件后 `user_prefs` 表无限膨胀的问题。
- 优化了数据库日志，移除了正常的 "record not found" 干扰信息。

## 升级指南 (Upgrade Guide)

1. **替换二进制文件**: 直接覆盖旧版本可执行文件。
2. **安装 FFmpeg** (可选): 如果需要播放 MKV/FLAC 等格式，请确保服务器安装了 [FFmpeg](https://ffmpeg.org/) 并配置了环境变量。
3. **数据库迁移**: 启动时会自动创建新表 `playback_progresses`，无需手动干预。

---

**完整更新日志**: [CHANGELOG.md](../../CHANGELOG.md)
