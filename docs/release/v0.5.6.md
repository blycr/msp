# MSP v0.5.6 发布说明

## 核心更新
- **引入 SQLite 增量扫描**
  - **后端**：从 v0.5.6 起，MSP 引入 SQLite 作为元数据存储。默认启用增量更新模式，只有变动或新增文件会被重新处理。
  - **性能**：大幅降低重复启动时的扫描开销，数万文件的库也能实现秒级启动与毫秒级列表响应。
  - **配置**：新增 `maxItems: 0`（推荐）配置项以开启无限制全量扫描；旧有的 `>0` 限制仍保留用于快速预览场景。
  - **兼容性**：自动迁移旧数据，自动创建 `msp.db`；若存在旧数据库，会自动添加缺失列并重建索引。

## 修复
- **数据库兼容性**：修复旧版数据库升级时因缺失列导致的初始化失败问题（自动补全 `scan_id` 列后再创建索引）。
- **前端请求优化**：修复前端 URL 参数拼接逻辑，解决刷新或带限制参数时的请求错误。
- “在新标签打开”字幕缺失与安全策略拦截
  - 含字幕视频的新标签页不再使用 `data:`，改为同源 `blob:`，避免浏览器对顶层 `data:` 导航的限制
  - 生成的轻量 HTML 使用绝对地址加载视频与字幕，确保正常解析与显示
- 移除此前误引入的预览深链逻辑，恢复原始直链行为（仅在含字幕视频时启用轻量 HTML）

## 后端调整
- **日志路径**：日志默认路径调整为可写的子目录：`${exeDir}/logs/msp.log`（自动创建目录），避免在项目主目录生成顶层 `msp.log`
- **配置结构**：`maxItems` 默认值调整为 `0`，引导用户使用更高效的增量扫描模式。

## 开发与构建
- 开发/构建脚本保持不变：可执行文件输出在 `bin/**`，不会在主目录生成 `msp.exe`
- 完善了文档结构，将详细配置指南迁移至 Wiki，保持 README 轻量化。

## English Summary
- **SQLite Incremental Scanning**: Introduced SQLite for metadata storage. Default `maxItems: 0` enables unlimited incremental scans, significantly boosting startup and query performance for large libraries.
- **Database Migration**: Fixed initialization issues on existing databases by ensuring columns exist before index creation.
- **Frontend Fixes**: Corrected URL parameter concatenation for refresh/limit requests.
- New-tab subtitle preview uses same-origin `blob:` instead of `data:`, fixing top navigation restrictions.
- Lightweight HTML injects absolute URLs for video and tracks.
- Default log file path moves to `${exeDir}/logs/msp.log`.
- Updated documentation: Moved detailed config guide to Wiki, kept README lightweight.

