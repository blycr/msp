# MSP v0.9.4 发布说明

## 🚀 核心更新：智能播放策略 (Smart Playback)

v0.9.4 带来了一次底层的播放逻辑重构，彻底解决了 "为什么我的 AVI/MKV 播不了？" 的问题。

### 1. Try-First, Fallback-Next (优先直连，失败回退)
不再根据文件后缀（如 `.mkv`, `.mp4`）简单粗暴地决定是否转码。
- **所有文件**首先尝试**原生播放 (Direct Play)**。
- 如果浏览器无法解码（报错 Code 3/4）或明确表示不支持（如 AVI），前端会自动向后端申请**实时转码**。
- 这意味着：只要你的浏览器能播（例如装了 HEVC 插件），MSP 就会利用硬件解码，零 CPU 占用；只有真正播不了的，才会动用 FFmpeg。

### 2. 完美的 AVI/MKV 支持
- 修复了 AVI 文件在 Chrome 下会被当成下载文件的问题。
- 修复了转码流无法拖动进度条的问题（Smart Seeking 回归）。

### 3. 后端并发保护
- 新增转码并发限制（默认为 2），防止多用户同时转码把服务器 CPU 跑满卡死。

## 升级指南

1. 下载最新二进制文件。
2. **强烈建议**在 `config.json` 中确保开启转码功能，以获得最佳兼容性：
   ```json
   "playback": {
     "video": { "transcode": true },
     "audio": { "transcode": true }
   }
   ```
   *注：开启此选项**不会**导致所有视频都转码，只有浏览器播不了的才会转码。*
