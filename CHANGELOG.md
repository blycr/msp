# Changelog

## 0.8.6

- **代码质量重构**：媒体扫描/入库/响应构建与部分 API Handler 逻辑拆分，降低复杂度、便于维护。
- **行为不变**：以重构为主，无破坏性改动。

## 0.8.5

- **UI 优雅升级**：视频播放器与图片预览全面圆角化；修复列表项高度塌陷；优化暗黑模式下输入框与按钮质感。
- **播放器增强**：修复 Tooltip 被容器遮挡问题（重构 CSS Overflow 逻辑）；修复快速切换视频时的 `canPlayType` 报错。

## 0.8.4

- **播放策略重构**：实施 "Try-First, Fallback-Next" 策略。不再根据文件后缀判断，而是优先尝试原生播放。如果浏览器拒绝（如 AVI）或解码失败（如 H.265），前端自动请求转码。
- **AVI/MKV 修复**：完美修复 AVI 等格式在 Chrome 中无法播放的问题。通过 `canPlayType` 智能预判，对不支持的格式直接启用转码，避免下载弹窗。
- **稳定性增强**：
  - 优化播放器看门狗（Watchdog），防止转码启动慢导致的误杀。
  - 修复播放列表切换时的转码状态丢失问题。
  - 恢复并优化 Smart Seeking，转码流现在支持拖动进度条。
- **后端优化**：实现转码并发限制（默认 2 路），防止 CPU 耗尽。
- **配置更新**：`config.example.json` 默认开启转码以支持智能回退。

## 0.8.0

- **数据库优化**：新增 `playback_progresses` 表，将高频播放进度更新从 `user_prefs` 表中分离，显著提升性能并减少数据库膨胀
- **智能转码**：新增 FFmpeg 服务端转码支持，自动识别并转码浏览器不支持的格式（如 MKV, FLAC, AVI）
- **API 新增**：新增 `/api/progress` 端点，专门用于处理播放进度
- **文档**：更新 wiki 增加转码配置说明；明确转码模式下暂不支持拖拽进度条（Seeking）

## 0.7.0

- **安全增强**：新增基于 IP 的黑/白名单机制，支持单个 IP 和 CIDR 范围（/8, /16, /24）
- **PIN 认证**：新增 PIN 码认证功能，默认 PIN 为 0000，可在配置文件中自定义
- **配置扩展**：在 `config.json` 中新增 `security` 配置部分
- **API 端点**：新增 `/api/pin` 端点用于 PIN 验证
- **文档完善**：新增安全配置指南（`docs/SECURITY.md`）和配置示例文档（`docs/CONFIG_EXAMPLE.md`）
- **测试覆盖**：为安全功能添加完整的单元测试

## 0.6.0

- **UI/UX 全面升级**：遵循 UI/UX Pro Max 设计规范，替换 emoji 为 SVG 图标，优化颜色对比度和交互体验
- **交互改进**：所有可交互元素添加 hover 反馈和键盘导航支持，统一过渡动画为 200ms
- **无障碍性**：添加 `aria-label`、支持 `prefers-reduced-motion`、改进焦点可见性
- **响应式优化**：改进移动端布局和对话框显示
- **构建修复**：修复 PowerShell 构建脚本中 npm 调用问题

## 0.5.8

- **重构**：后端全面引入 `context.Context`，支持请求超时与优雅取消
- **修复**：修复 Gosec SQL 拼接误报与部分编译错误
- **安全**：数据库查询全面升级为参数化与 Context 感知

## 0.5.7

- **重构**：核心模块拆分为 Scanner/Store/Media 三层架构
- **CI**：集成 GitHub Actions 进行自动构建与 Lint 检查
- **质量**：引入 golangci-lint 规范代码风格

## 0.5.6

- 特性：服务启动后自动打开浏览器并彩色输出访问地址
- 改进：CI 发布流程加固与加速（Go 缓存、依赖优化）

## 0.5.5

- 新增 `scripts/dev.ps1`，支持后端自动重编译 + 前端联动开发
- 开发模式默认关闭“自动打开浏览器预览”，正式构建不受影响
- 配置与黑名单字段在缺省时自动补齐，兼容旧配置
- Vite 开发服务器支持局域网访问，便于手机端调试
- 列表与播放列表分页条布局优化（Prev/Next 左右、页码居中）
- Footer 文案与结构重排，统一品牌展示与多语言文案
- `.gitignore` 补充本地运行产物/构建输出忽略项

## 0.2.0

- 修复：PC 端 Plyr 全屏视频四周黑边（支持 cover/contain 切换）
- 修复：`/api/stream` 为常见媒体类型返回更稳定的 `Content-Type`
- 改进：前端静态资源统一收敛到 `web/static`，embed 逻辑更清晰
- 改进：`config.json` 作为本机运行时配置不再提交；提供 `config.example.json`
- 改进：非视频页面隐藏“填充模式”按钮，交互更一致

## 0.1.0

- 初版：局域网媒体共享与浏览器预览播放
