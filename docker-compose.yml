services:
  msp:
    build: .
    image: msp-server:latest
    container_name: msp
    restart: unless-stopped
    ports:
      - "8099:8099"
    volumes:
      # Map config and database to host for persistence
      # The app expects config.json and msp.db in the working directory (/app)
      - ./data:/data
      # Map your media folders
      - ./media:/media
    environment:
      - MSP_NO_AUTO_OPEN=1
    # Create symlinks at startup to map /data/config.json -> /app/config.json
    # This allows users to map a single volume for all data
    entrypoint: ["/bin/sh", "-c", "ln -sf /data/config.json /app/config.json && ln -sf /data/msp.db /app/msp.db && ./msp-server"]
